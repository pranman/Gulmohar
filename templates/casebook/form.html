{% extends "base.html" %}

{% block title %}{% if mode == 'edit' %}Edit{% else %}Create{% endif %} Case Study{% endblock %}

{% block content %}
<main style="max-width: 1100px; margin: 2rem auto; padding: 0 1rem;">
    <p><a href="{% url 'casebook_index' %}">Back to case list</a></p>
    <h1>{% if mode == "edit" %}Edit{% else %}Create{% endif %} Case Study</h1>

    <form method="post">
        {% csrf_token %}

        <section style="margin-bottom: 2rem;">
            <h2>Case study fields</h2>
            {% for field in case_form %}
            <div style="margin-bottom: 1rem;">
                <label for="{{ field.id_for_label }}"><strong>{{ field.label }}</strong></label><br />
                {{ field }}
                {% if field.help_text %}
                <div style="font-size: 0.9rem; color: #666;">{{ field.help_text }}</div>
                {% endif %}
                {% for error in field.errors %}
                <div style="color: #b30000;">{{ error }}</div>
                {% endfor %}
            </div>
            {% endfor %}
            {% for error in case_form.non_field_errors %}
            <div style="color: #b30000;">{{ error }}</div>
            {% endfor %}
        </section>

        <section style="margin-bottom: 2rem;">
            <h2>Assets</h2>
            {{ asset_formset.management_form }}
            {% for form in asset_formset %}
            <fieldset style="border: 1px solid #ccc; margin-bottom: 1rem; padding: 1rem;">
                <legend>Asset {{ forloop.counter }}</legend>
                {% for hidden in form.hidden_fields %}{{ hidden }}{% endfor %}
                {% for field in form.visible_fields %}
                <div style="margin-bottom: 0.5rem;">
                    <label for="{{ field.id_for_label }}">{{ field.label }}</label><br />
                    {{ field }}
                    {% if field.help_text %}<div style="font-size: 0.9rem; color: #666;">{{ field.help_text }}</div>{% endif %}
                    {% for error in field.errors %}<div style="color: #b30000;">{{ error }}</div>{% endfor %}
                </div>
                {% endfor %}
            </fieldset>
            {% endfor %}
        </section>

        <section style="margin-bottom: 2rem;">
            <h2>Metrics</h2>
            {{ metric_formset.management_form }}
            {% for form in metric_formset %}
            <fieldset style="border: 1px solid #ccc; margin-bottom: 1rem; padding: 1rem;">
                <legend>Metric {{ forloop.counter }}</legend>
                {% for hidden in form.hidden_fields %}{{ hidden }}{% endfor %}
                {% for field in form.visible_fields %}
                <div style="margin-bottom: 0.5rem;">
                    <label for="{{ field.id_for_label }}">{{ field.label }}</label><br />
                    {{ field }}
                    {% if field.help_text %}<div style="font-size: 0.9rem; color: #666;">{{ field.help_text }}</div>{% endif %}
                    {% for error in field.errors %}<div style="color: #b30000;">{{ error }}</div>{% endfor %}
                </div>
                {% endfor %}
            </fieldset>
            {% endfor %}
        </section>

        <section style="margin-bottom: 2rem;">
            <h2>Channel spend</h2>
            {{ channel_spend_formset.management_form }}
            {% for form in channel_spend_formset %}
            <fieldset style="border: 1px solid #ccc; margin-bottom: 1rem; padding: 1rem;">
                <legend>Channel spend {{ forloop.counter }}</legend>
                {% for hidden in form.hidden_fields %}{{ hidden }}{% endfor %}
                {% for field in form.visible_fields %}
                <div style="margin-bottom: 0.5rem;">
                    <label for="{{ field.id_for_label }}">{{ field.label }}</label><br />
                    {{ field }}
                    {% if field.help_text %}<div style="font-size: 0.9rem; color: #666;">{{ field.help_text }}</div>{% endif %}
                    {% for error in field.errors %}<div style="color: #b30000;">{{ error }}</div>{% endfor %}
                </div>
                {% endfor %}
            </fieldset>
            {% endfor %}
        </section>

        <button type="submit">{% if mode == "edit" %}Save changes{% else %}Create case study{% endif %}</button>
    </form>
</main>
{% endblock %}
