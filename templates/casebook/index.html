{% extends "base.html" %}

{% block title %}Casebook{% endblock %}

{% block content %}
<main style="max-width: 1100px; margin: 2rem auto; padding: 0 1rem;">
    <h1>Portfolio Casebook</h1>
    <p>Local case study browser and editor.</p>

    <p>
        <a href="{% url 'casebook_create' %}">Create a new case study</a>
        | <a href="/admin/snippets/casebook/casestudy/">Open snippet admin</a>
    </p>

    <form method="get" style="display: grid; grid-template-columns: repeat(5, minmax(120px, 1fr)); gap: 0.75rem; margin: 1.5rem 0;">
        <input type="text" name="q" value="{{ query }}" placeholder="Search title/client/brand/one-liner" />
        <select name="status">
            <option value="">Any status</option>
            {% for key, label in status_choices %}
            <option value="{{ key }}" {% if status == key %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
        </select>
        <select name="confidentiality">
            <option value="">Any confidentiality</option>
            {% for key, label in confidentiality_choices %}
            <option value="{{ key }}" {% if confidentiality == key %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
        </select>
        <input type="text" name="tag" value="{{ tag }}" placeholder="Tag" />
        <button type="submit">Filter</button>
    </form>

    {% if cases %}
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr>
                <th style="text-align: left; border-bottom: 1px solid #ccc;">Title</th>
                <th style="text-align: left; border-bottom: 1px solid #ccc;">Client/Org</th>
                <th style="text-align: left; border-bottom: 1px solid #ccc;">Status</th>
                <th style="text-align: left; border-bottom: 1px solid #ccc;">Confidentiality</th>
                <th style="text-align: left; border-bottom: 1px solid #ccc;">Sort Date</th>
                <th style="text-align: left; border-bottom: 1px solid #ccc;">Tags</th>
            </tr>
        </thead>
        <tbody>
            {% for case in cases %}
            <tr>
                <td style="padding: 0.5rem 0;">
                    <a href="{% url 'casebook_detail' slug=case.slug %}">{{ case.title }}</a>
                    <div><a href="{% url 'casebook_edit' slug=case.slug %}">Edit</a></div>
                </td>
                <td>{{ case.client_or_org|default:"-" }}</td>
                <td>{{ case.get_status_display }}</td>
                <td>{{ case.get_confidentiality_display }}</td>
                <td>{{ case.sort_date|default:"-" }}</td>
                <td>
                    {% for tag in case.tags.all %}
                    {{ tag.name }}{% if not forloop.last %}, {% endif %}
                    {% empty %}-{% endfor %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>No cases found.</p>
    {% endif %}
</main>
{% endblock %}
